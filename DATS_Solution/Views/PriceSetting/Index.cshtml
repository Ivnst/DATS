@model IEnumerable<DATS.PriceView>
@using DATS;

@{
    ViewBag.Title = "Справочник цен: Список";
    Layout = "~/Views/Shared/_SettingLayout.cshtml";
}

<script>
    $(document).ready(function () {
        $(".iksar").val(function (i, v) {
            return v.replace(",", "."); });
        $('#FormForSave').submit(function (event) {
            event.preventDefault();
            var subFind = $(this);
            if (validium()) {
                var data = subFind.serialize();
                var url = subFind.attr('action');
                    $.post(url, data, function () {
                    window.location = "/Settings/Prices?sid=@ViewBag.Stadium.Id&&mid=@ViewBag.Match.Id";
                    });
                }
            });
            // start validation
            $(".iksar").keydown(function (e) {
                // Allow: backspace, delete, tab, escape, enter and .
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                    // Allow: Ctrl+A
                    (e.keyCode == 65 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    // let it happen, don't do anything
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });
            // end validation
    });
    function validium() {
        var nonError = true;
        var errMessage1 = "", errMessage2 = "";
        $(".iksar").val(function (i, v) {
            if ((v.length > 0) && (isFinite(v) == false)) { nonError = false; errMessage1 = "Данные не сохранены, так как одно или несколько значений содержат ошибку.\n" }
            if ((v.length > 0) && (isFinite(v) == true) && (v > 1000000000)) { nonError = false; errMessage2 = "Данные не сохранены, так как цена ограничена значением 1000000000." }
            return v;
        });
        if (nonError == false) alert(errMessage1 + errMessage2);
        return nonError;
    }
</script>

<div style="margin: 0 0 10px">
    <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            @ViewBag.Stadium.Name <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            @foreach (var sv in ViewBag.Stadiumes)
            {
                <li><a href="/Settings/Prices?sid=@sv.Id">@sv.Name</a></li>
            }

        </ul>
    </div>
    <div class="btn-group" style="margin: 0 0 0 10px">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            @ViewBag.Match.Name <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            @foreach (var mv in ViewBag.Matchess)
            {
                <li><a href="/Settings/Prices?sid=@ViewBag.Stadium.Id&&mid=@mv.Id">@mv.Name</a></li>
            }

        </ul>
    </div>
</div>

@using (Html.BeginForm("Save", "PriceSetting", FormMethod.Post, new { Id = "FormForSave" }))
{
    @Html.ValidationSummary(true)
    
    <input type="submit" class="btn btn-primary" value="Сохранить" id="iksar" style="margin: 0 0 10px" />

<div>
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th style="display: none;">
                </th>
                <th style="display: none;">
                </th>
                <th style="display: none;">
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.PriceValue)
                </th>
            </tr>
        </thead>
        <tbody>

            @foreach (var item in Model)
            {
                <tr>
                    <td style="display: none;">
                        @Html.TextBoxFor(modelItem => item.StadiumId, new { @class = "hidden", @readonly = "readonly" })
                    </td>
                    <td style="display: none;">
                        @Html.TextBoxFor(modelItem => item.MatchId, new { @class = "hidden", @readonly = "readonly" })
                    </td>
                    <td style="display: none;">
                        @Html.TextBoxFor(modelItem => item.SectorId, new { @class = "hidden", @readonly = "readonly" })
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Name)
                    </td>
                    <td>
                        @Html.TextBoxFor(modelItem => item.PriceValue, new { @class = "form-control iksar" })
                    </td>
                </tr>
            }

        </tbody>
</table>
</div>
    
}




